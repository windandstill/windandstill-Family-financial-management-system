<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.aka.mapper.UserMapper">

    <select id="selectRoleids" parameterType="int" resultType="map">
        select a.roleid,b.rolename from t_user_role a,t_role b where a.roleid=b.id and a.userid=#{id}
    </select>



    <select id="findUserAndRoleByNP" parameterType="User" resultType="User">
        select u.*, r.id roleid,r.rolename from ffms.t_user u left JOIN ffms.t_user_role ur ON u.id=ur.userid INNER JOIN ffms.t_role r ON ur.roleid = r.id
where u.username=#{username} and u.password=#{password} and r.id=#{roleid};
    </select>

    <select id="getAllUsers" parameterType="Map" resultType="user">
        select id,username from t_user
        <where>
--             判断用户是否有效的条件
            isvalid=1
--             普通用户
            <if test="userid!=null and roleid!=1">
                and id=#{userid}
            </if>
        </where>
    </select>

    <select id="findUserByUsername" resultType="User">
        select * from ffms.t_user where username=#{username};
    </select>

    <select id="findAllUserByPage" parameterType="pageBean" resultType="User">
        select u.*, r.id roleid,r.rolename from ffms.t_user u left JOIN ffms.t_user_role ur ON u.id=ur.userid INNER JOIN ffms.t_role r ON ur.roleid = r.id
limit #{page} ,#{pageSize};
    </select>
    <select id="findTotalUser" resultType="java.lang.Integer">
        select count(*) from ffms.t_user
    </select>

    <insert id="insertUser" parameterType="User">
        insert into ffms.t_user (username,password,createtime) value (#{username},#{password},#{createtime})
    </insert>

    <insert id="insertUserRole">
        insert into ffms.t_user_role (userid, roleid) VALUE (#{id},#{roleid})
    </insert>
</mapper>